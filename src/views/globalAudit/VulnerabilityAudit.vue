<template>
  <div class="animated fadeIn">
    <b-tabs
      class="body-bg-color"
      style="border-left: 0; border-right: 0; border-top: 0"
      v-model="tabIndex"
    >
      <b-tab
        ref="occurrences"
        style="border-left: 0; border-right: 0; border-top: 0"
        @click="routeTo()"
        lazy
      >
        <template v-slot:title>
          <i class="fa fa-shield"></i>
          {{ $t('message.vulnerabilities_by_occurrence') }}
        </template>
        <VulnerabilityAuditByOccurrence />
      </b-tab>
      <b-tab
        ref="grouped"
        style="border-left: 0; border-right: 0; border-top: 0"
        @click="routeTo('grouped')"
        lazy
      >
        <template v-slot:title>
          <i class="fa fa-shield"></i>
          {{ $t('message.grouped_vulnerabilities') }}
        </template>
        <VulnerabilityAuditGroupedByVulnerability />
      </b-tab>
    </b-tabs>
  </div>
</template>

<script>
import VulnerabilityAuditGroupedByVulnerability from '@/views/globalAudit/VulnerabilityAuditGroupedByVulnerability';
import VulnerabilityAuditByOccurrence from '@/views/globalAudit/VulnerabilityAuditByOccurrence';

export default {
  mixins: [],
  components: {
    VulnerabilityAuditByOccurrence,
    VulnerabilityAuditGroupedByVulnerability,
  },
  data() {
    return {
      tabIndex: 0,
      visitedTabs: new Set(),
    };
  },
  methods: {
    routeTo(path) {
      if (path) {
        if (
          !this.$route.fullPath.toLowerCase().includes('/' + path.toLowerCase())
        ) {
          this.$router.push({ path: '/vulnerabilityAudit/' + path });
        }
      } else if (
        this.$route.fullPath !== '/audit' &&
        this.$route.fullPath !== '/vulnerabilityAudit/'
      ) {
        this.$router.push({ path: '/vulnerabilityAudit/' });
      }
    },
    getTabFromRoute() {
      let pattern = new RegExp('/vulnerabilityAudit\\/([^\\/]*)', 'gi');
      let tab = pattern.exec(this.$route.fullPath.toLowerCase());
      this.tabIndex =
        tab && tab[1] && tab[1].toLowerCase() === 'grouped' ? 1 : 0;
      return this.$refs[tab && tab[1] ? tab[1].toLowerCase() : 'occurrences'];
    },
  },
  beforeMount() {
    this.getTabFromRoute();
  },
  watch: {
    $route(to, from) {
      this.getTabFromRoute().activate();
    },
  },
};
</script>
